{"ast":null,"code":"var ical = require('./ical'),\n  fs = require('fs');\nexports.parseFile = function (filename) {\n  return ical.parseICS(fs.readFileSync(filename, 'utf8'));\n};\nvar rrule = require('rrule').RRule;\nical.objectHandlers['RRULE'] = function (val, params, curr, stack, line) {\n  curr.rrule = line;\n  return curr;\n};\nvar originalEnd = ical.objectHandlers['END'];\nical.objectHandlers['END'] = function (val, params, curr, stack) {\n  // Recurrence rules are only valid for VEVENT, VTODO, and VJOURNAL.\n  // More specifically, we need to filter the VCALENDAR type because we might end up with a defined rrule\n  // due to the subtypes.\n  if (val === \"VEVENT\" || val === \"VTODO\" || val === \"VJOURNAL\") {\n    if (curr.rrule) {\n      var rule = curr.rrule.replace('RRULE:', '');\n      if (rule.indexOf('DTSTART') === -1) {\n        if (curr.start.length === 8) {\n          var comps = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(curr.start);\n          if (comps) {\n            curr.start = new Date(comps[1], comps[2] - 1, comps[3]);\n          }\n        }\n        if (typeof curr.start.toISOString === 'function') {\n          try {\n            rule += ';DTSTART=' + curr.start.toISOString().replace(/[-:]/g, '');\n            rule = rule.replace(/\\.[0-9]{3}/, '');\n          } catch (error) {\n            console.error(\"ERROR when trying to convert to ISOString\", error);\n          }\n        } else {\n          console.error(\"No toISOString function in curr.start\", curr.start);\n        }\n      }\n      curr.rrule = rrule.fromString(rule);\n    }\n  }\n  return originalEnd.call(this, val, params, curr, stack);\n};","map":{"version":3,"names":["ical","require","fs","exports","parseFile","filename","parseICS","readFileSync","rrule","RRule","objectHandlers","val","params","curr","stack","line","originalEnd","rule","replace","indexOf","start","length","comps","exec","Date","toISOString","error","console","fromString","call"],"sources":["C:/Users/Safern/Downloads/cal/node_modules/ical/node-ical.js"],"sourcesContent":["var ical = require('./ical')\n  , fs = require('fs')\n\nexports.parseFile = function(filename){\n  return ical.parseICS(fs.readFileSync(filename, 'utf8'))\n}\n\nvar rrule = require('rrule').RRule\n\nical.objectHandlers['RRULE'] = function(val, params, curr, stack, line){\n  curr.rrule = line;\n  return curr\n}\nvar originalEnd = ical.objectHandlers['END'];\nical.objectHandlers['END'] = function (val, params, curr, stack) {\n\t// Recurrence rules are only valid for VEVENT, VTODO, and VJOURNAL.\n\t// More specifically, we need to filter the VCALENDAR type because we might end up with a defined rrule\n\t// due to the subtypes.\n\tif ((val === \"VEVENT\") || (val === \"VTODO\") || (val === \"VJOURNAL\")) {\n\t\tif (curr.rrule) {\n\t\t\tvar rule = curr.rrule.replace('RRULE:', '');\n\t\t\tif (rule.indexOf('DTSTART') === -1) {\n\n\t\t\t\tif (curr.start.length === 8) {\n\t\t\t\t\tvar comps = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(curr.start);\n\t\t\t\t\tif (comps) {\n\t\t\t\t\t\tcurr.start = new Date(comps[1], comps[2] - 1, comps[3]);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\n\t\t\t\tif (typeof curr.start.toISOString === 'function') {\n\t\t\t\t\ttry {\n\t\t\t\t\t\trule += ';DTSTART=' + curr.start.toISOString().replace(/[-:]/g, '');\n\t\t\t\t\t\trule = rule.replace(/\\.[0-9]{3}/, '');\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(\"ERROR when trying to convert to ISOString\", error);\n\t\t\t\t\t}\n                } else {\n                    console.error(\"No toISOString function in curr.start\", curr.start);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcurr.rrule = rrule.fromString(rule);\n\t\t}\n\t}\n  return originalEnd.call(this, val, params, curr, stack);\n}\n"],"mappings":"AAAA,IAAIA,IAAI,GAAGC,OAAO,CAAC,QAAQ,CAAC;EACxBC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC;AAEtBE,OAAO,CAACC,SAAS,GAAG,UAASC,QAAQ,EAAC;EACpC,OAAOL,IAAI,CAACM,QAAQ,CAACJ,EAAE,CAACK,YAAY,CAACF,QAAQ,EAAE,MAAM,CAAC,CAAC;AACzD,CAAC;AAED,IAAIG,KAAK,GAAGP,OAAO,CAAC,OAAO,CAAC,CAACQ,KAAK;AAElCT,IAAI,CAACU,cAAc,CAAC,OAAO,CAAC,GAAG,UAASC,GAAG,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,IAAI,EAAC;EACrEF,IAAI,CAACL,KAAK,GAAGO,IAAI;EACjB,OAAOF,IAAI;AACb,CAAC;AACD,IAAIG,WAAW,GAAGhB,IAAI,CAACU,cAAc,CAAC,KAAK,CAAC;AAC5CV,IAAI,CAACU,cAAc,CAAC,KAAK,CAAC,GAAG,UAAUC,GAAG,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAE;EAChE;EACA;EACA;EACA,IAAKH,GAAG,KAAK,QAAQ,IAAMA,GAAG,KAAK,OAAQ,IAAKA,GAAG,KAAK,UAAW,EAAE;IACpE,IAAIE,IAAI,CAACL,KAAK,EAAE;MACf,IAAIS,IAAI,GAAGJ,IAAI,CAACL,KAAK,CAACU,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;MAC3C,IAAID,IAAI,CAACE,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,EAAE;QAEnC,IAAIN,IAAI,CAACO,KAAK,CAACC,MAAM,KAAK,CAAC,EAAE;UAC5B,IAAIC,KAAK,GAAG,yBAAyB,CAACC,IAAI,CAACV,IAAI,CAACO,KAAK,CAAC;UACtD,IAAIE,KAAK,EAAE;YACVT,IAAI,CAACO,KAAK,GAAG,IAAII,IAAI,CAACF,KAAK,CAAC,CAAC,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,EAAEA,KAAK,CAAC,CAAC,CAAC,CAAC;UACxD;QACD;QAGA,IAAI,OAAOT,IAAI,CAACO,KAAK,CAACK,WAAW,KAAK,UAAU,EAAE;UACjD,IAAI;YACHR,IAAI,IAAI,WAAW,GAAGJ,IAAI,CAACO,KAAK,CAACK,WAAW,CAAC,CAAC,CAACP,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;YACnED,IAAI,GAAGA,IAAI,CAACC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;UACtC,CAAC,CAAC,OAAOQ,KAAK,EAAE;YACfC,OAAO,CAACD,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;UAClE;QACW,CAAC,MAAM;UACHC,OAAO,CAACD,KAAK,CAAC,uCAAuC,EAAEb,IAAI,CAACO,KAAK,CAAC;QAClF;MACD;MACAP,IAAI,CAACL,KAAK,GAAGA,KAAK,CAACoB,UAAU,CAACX,IAAI,CAAC;IACpC;EACD;EACC,OAAOD,WAAW,CAACa,IAAI,CAAC,IAAI,EAAElB,GAAG,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,CAAC;AACzD,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script"}