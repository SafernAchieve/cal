{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport RRule from './rrule';\nimport dateutil from './dateutil';\nimport { includes } from './helpers';\n/**\n *\n * @param {Boolean?} noCache\n *  The same stratagy as RRule on cache, default to false\n * @constructor\n */\nvar RRuleSet = /** @class */function (_super) {\n  __extends(RRuleSet, _super);\n  function RRuleSet(noCache) {\n    if (noCache === void 0) {\n      noCache = false;\n    }\n    var _this = _super.call(this, {}, noCache) || this;\n    _this._rrule = [];\n    _this._rdate = [];\n    _this._exrule = [];\n    _this._exdate = [];\n    return _this;\n  }\n  /**\n   * Adds an RRule to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.rrule = function (rrule) {\n    if (!(rrule instanceof RRule)) {\n      throw new TypeError(String(rrule) + ' is not RRule instance');\n    }\n    if (!includes(this._rrule.map(String), String(rrule))) {\n      this._rrule.push(rrule);\n    }\n  };\n  /**\n   * Adds an RDate to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.rdate = function (date) {\n    if (!(date instanceof Date)) {\n      throw new TypeError(String(date) + ' is not Date instance');\n    }\n    if (!includes(this._rdate.map(Number), Number(date))) {\n      this._rdate.push(date);\n      dateutil.sort(this._rdate);\n    }\n  };\n  /**\n   * Adds an EXRULE to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.exrule = function (rrule) {\n    if (!(rrule instanceof RRule)) {\n      throw new TypeError(String(rrule) + ' is not RRule instance');\n    }\n    if (!includes(this._exrule.map(String), String(rrule))) {\n      this._exrule.push(rrule);\n    }\n  };\n  /**\n   * Adds an EXDATE to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.exdate = function (date) {\n    if (!(date instanceof Date)) {\n      throw new TypeError(String(date) + ' is not Date instance');\n    }\n    if (!includes(this._exdate.map(Number), Number(date))) {\n      this._exdate.push(date);\n      dateutil.sort(this._exdate);\n    }\n  };\n  RRuleSet.prototype.valueOf = function () {\n    var result = [];\n    if (this._rrule.length) {\n      this._rrule.forEach(function (rrule) {\n        result.push('RRULE:' + rrule);\n      });\n    }\n    if (this._rdate.length) {\n      result.push('RDATE:' + this._rdate.map(function (rdate) {\n        return dateutil.timeToUntilString(rdate.valueOf());\n      }).join(','));\n    }\n    if (this._exrule.length) {\n      this._exrule.forEach(function (exrule) {\n        result.push('EXRULE:' + exrule);\n      });\n    }\n    if (this._exdate.length) {\n      result.push('EXDATE:' + this._exdate.map(function (exdate) {\n        return dateutil.timeToUntilString(exdate.valueOf());\n      }).join(','));\n    }\n    return result;\n  };\n  /**\n   * to generate recurrence field sush as:\n   *   [\"RRULE:FREQ=YEARLY;COUNT=2;BYDAY=TU;DTSTART=19970902T010000Z\",\"RRULE:FREQ=YEARLY;COUNT=1;BYDAY=TH;DTSTART=19970902T010000Z\"]\n   */\n  RRuleSet.prototype.toString = function () {\n    return JSON.stringify(this.valueOf());\n  };\n  RRuleSet.prototype._iter = function (iterResult) {\n    var _exdateHash = {};\n    var _exrule = this._exrule;\n    var _accept = iterResult.accept;\n    function evalExdate(after, before) {\n      _exrule.forEach(function (rrule) {\n        rrule.between(after, before, true).forEach(function (date) {\n          _exdateHash[Number(date)] = true;\n        });\n      });\n    }\n    this._exdate.forEach(function (date) {\n      _exdateHash[Number(date)] = true;\n    });\n    iterResult.accept = function (date) {\n      var dt = Number(date);\n      if (!_exdateHash[dt]) {\n        evalExdate(new Date(dt - 1), new Date(dt + 1));\n        if (!_exdateHash[dt]) {\n          _exdateHash[dt] = true;\n          return _accept.call(this, date);\n        }\n      }\n      return true;\n    };\n    if (iterResult.method === 'between') {\n      evalExdate(iterResult.args.after, iterResult.args.before);\n      iterResult.accept = function (date) {\n        var dt = Number(date);\n        if (!_exdateHash[dt]) {\n          _exdateHash[dt] = true;\n          return _accept.call(this, date);\n        }\n        return true;\n      };\n    }\n    for (var i = 0; i < this._rdate.length; i++) {\n      if (!iterResult.accept(new Date(this._rdate[i].valueOf()))) break;\n    }\n    this._rrule.forEach(function (rrule) {\n      rrule._iter(iterResult);\n    });\n    var res = iterResult._result;\n    dateutil.sort(res);\n    switch (iterResult.method) {\n      case 'all':\n      case 'between':\n        return res;\n      case 'before':\n        return res.length && res[res.length - 1] || null;\n      case 'after':\n        return res.length && res[0] || null;\n      default:\n        return null;\n    }\n  };\n  /**\n   * Create a new RRuleSet Object completely base on current instance\n   */\n  RRuleSet.prototype.clone = function () {\n    var rrs = new RRuleSet(!!this._cache);\n    var i;\n    for (i = 0; i < this._rrule.length; i++) {\n      rrs.rrule(this._rrule[i].clone());\n    }\n    for (i = 0; i < this._rdate.length; i++) {\n      rrs.rdate(new Date(this._rdate[i].valueOf()));\n    }\n    for (i = 0; i < this._exrule.length; i++) {\n      rrs.exrule(this._exrule[i].clone());\n    }\n    for (i = 0; i < this._exdate.length; i++) {\n      rrs.exdate(new Date(this._exdate[i].valueOf()));\n    }\n    return rrs;\n  };\n  return RRuleSet;\n}(RRule);\nexport default RRuleSet;","map":{"version":3,"names":["RRule","dateutil","includes","RRuleSet","_super","__extends","noCache","_this","call","_rrule","_rdate","_exrule","_exdate","prototype","rrule","TypeError","String","map","push","rdate","date","Date","Number","sort","exrule","exdate","valueOf","result","length","forEach","timeToUntilString","join","toString","JSON","stringify","_iter","iterResult","_exdateHash","_accept","accept","evalExdate","after","before","between","dt","method","args","i","res","_result","clone","rrs","_cache"],"sources":["../../src/rruleset.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}