{"ast":null,"code":"import IterResult from './iterresult';\nimport dateutil from './dateutil';\nimport { isArray } from './helpers';\nvar Cache = /** @class */function () {\n  function Cache() {\n    this.all = false;\n    this.before = [];\n    this.after = [];\n    this.between = [];\n  }\n  /**\n   * @param {String} what - all/before/after/between\n   * @param {Array,Date} value - an array of dates, one date, or null\n   * @param {Object?} args - _iter arguments\n   */\n  Cache.prototype._cacheAdd = function (what, value, args) {\n    if (value) {\n      value = value instanceof Date ? dateutil.clone(value) : dateutil.cloneDates(value);\n    }\n    if (what === 'all') {\n      this.all = value;\n    } else {\n      args._value = value;\n      this[what].push(args);\n    }\n  };\n  /**\n   * @return false - not in the cache\n   *         null  - cached, but zero occurrences (before/after)\n   *         Date  - cached (before/after)\n   *         []    - cached, but zero occurrences (all/between)\n   *         [Date1, DateN] - cached (all/between)\n   */\n  Cache.prototype._cacheGet = function (what, args) {\n    var cached = false;\n    var argsKeys = args ? Object.keys(args) : [];\n    var findCacheDiff = function (item) {\n      for (var i = 0; i < argsKeys.length; i++) {\n        var key = argsKeys[i];\n        if (String(args[key]) !== String(item[key])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var cachedObject = this[what];\n    if (what === 'all') {\n      cached = this.all;\n    } else if (isArray(cachedObject)) {\n      // Let's see whether we've already called the\n      // 'what' method with the same 'args'\n      for (var i = 0; i < cachedObject.length; i++) {\n        var item = cachedObject[i];\n        if (argsKeys.length && findCacheDiff(item)) continue;\n        cached = item._value;\n        break;\n      }\n    }\n    if (!cached && this.all) {\n      // Not in the cache, but we already know all the occurrences,\n      // so we can find the correct dates from the cached ones.\n      var iterResult = new IterResult(what, args);\n      for (var i = 0; i < this.all.length; i++) {\n        if (!iterResult.accept(this.all[i])) break;\n      }\n      cached = iterResult.getValue();\n      this._cacheAdd(what, cached, args);\n    }\n    return isArray(cached) ? dateutil.cloneDates(cached) : cached instanceof Date ? dateutil.clone(cached) : cached;\n  };\n  return Cache;\n}();\nexport { Cache };","map":{"version":3,"names":["IterResult","dateutil","isArray","Cache","all","before","after","between","prototype","_cacheAdd","what","value","args","Date","clone","cloneDates","_value","push","_cacheGet","cached","argsKeys","Object","keys","findCacheDiff","item","i","length","key","String","cachedObject","iterResult","accept","getValue"],"sources":["../../src/cache.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}